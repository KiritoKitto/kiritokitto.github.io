<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="title" content="Kirito Kitto">
    <title>Kirito Kitto</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/5/w3.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap" rel="stylesheet">
    <link id="theme" rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/showroom.css">
</head>
<body>
  <header>
    <nav><p>
        <a href="/">Home</a>
        <a href="https://t.me/kiritokitto">Contact</a>
      </p></nav>
  </header>
  <main>
    <script src="/js/list/games.js"></script>

<h2 id="all-tracker">All-Tracker</h2>

<p><strong>All-Tracker</strong> è una lista di Giochi, Anime, Film e Serie TV che ho iniziato.</p>

<p><em>Ultima aggiornamento: Luglio 2025</em></p>

<hr />

<div class="track-filters">
<button class="track-type-btn active" data-type="All">All</button>
<button class="track-type-btn" data-type="Game">Games</button>
<button class="track-type-btn" data-type="Movie">Movie</button>
  <button class="track-type-btn" data-type="Show">Show</button>
<button class="track-type-btn" data-type="Anime">Anime</button>
</div>

<div class="track-filters">
<button class="track-status-btn active" data-status="All">All</button>
<button class="track-status-btn" data-status="Completed">Completed</button>
<button class="track-status-btn" data-status="Paused">Not Finished</button>
</div>

<div class="track-filters">
<button class="track-year-btn active" data-year="All">All</button>
<button class="track-year-btn" data-year="2025">2025</button>
<button class="track-year-btn" data-year="2024">2024</button>
<button class="track-year-btn" data-year="2023">2023</button>
</div>

<div class="track-filters">
<button class="track-fav-btn" data-fav="All">All</button>
<button class="track-fav-btn active" data-fav="Favorites">Favorites</button>
</div>

<div style="display:flex;">

  <div style="width:50%; text-align:center;">
    <p id="counter" style="font-weight:bold; font-size:24px; margin:0;">0</p>
    <p style="font-style:italic; font-size:14px; margin:0;">Titoli presenti</p>
  </div>

  <div style="width:50%; text-align:center;">
    <p id="average" style="font-weight:bold; font-size:24px; margin:0;">0</p>
    <p style="font-style:italic; font-size:14px; margin:0;">Average voti</p>
  </div>

</div>

<div id="track-summary" style="margin: 1rem 0; font-size: calc(0.7*var(--font-size)); color: var(--color-secondary);"></div>
<div class="track-grid" id="track-grid"></div>
<script>
const grid = document.getElementById("track-grid");
const statusButtons = document.querySelectorAll(".track-status-btn");
const yearButtons = document.querySelectorAll(".track-year-btn");
const typeButtons = document.querySelectorAll(".track-type-btn");
const favButtons = document.querySelectorAll(".track-fav-btn");

let currentStatus = "All";
let currentYear = "All";
let currentType = "All";
let currentFav = "Favorites";

function updateButtonStates() {
  const filteredGames = games.filter(game =>
    (currentStatus === "All" || game.status === currentStatus) &&
    (currentYear === "All" || game.year === currentYear) &&
    (currentType === "All" || game.type === currentType) &&
    (currentFav === "All" || (currentFav === "Favorites" && game.fav === "TRUE"))
  );

  function toggleButtons(buttons, key, valueMapper) {
    const valuesInFiltered = new Set(filteredGames.map(game => valueMapper(game)));

    buttons.forEach(button => {
      const value = button.dataset[key];

      const alwaysActive = (key === "fav")
        ? (value === "All" || value === "Favorites")
        : value === "All";

      if (alwaysActive) {
        button.removeAttribute("disabled");
        button.style.opacity = "1";
        button.style.pointerEvents = "auto";
      } else {
        const isAvailable = valuesInFiltered.has(value);
        if (isAvailable) {
          button.removeAttribute("disabled");
          button.style.opacity = "1";
          button.style.pointerEvents = "auto";
        } else {
          button.setAttribute("disabled", "true");
          button.style.opacity = "0.4";
          button.style.pointerEvents = "none";
        }
      }
    });
  }

  toggleButtons(statusButtons, "status", g => g.status);
  toggleButtons(yearButtons, "year", g => g.year);
  toggleButtons(typeButtons, "type", g => g.type);
  toggleButtons(favButtons, "fav", g => (g.fav === "TRUE" ? "Favorites" : "All"));
}

function renderCards() {
  grid.innerHTML = '';
  const filtered = games
    .filter(game =>
      (currentStatus === "All" || game.status === currentStatus) &&
      (currentYear === "All" || game.year === currentYear) &&
      (currentType === "All" || game.type === currentType) &&
      (currentFav === "All" || game.fav === "TRUE")
    )
    .sort((a, b) => parseInt(b.order) - parseInt(a.order));

  // Aggiorna conteggio e media
  const summaryDiv = document.getElementById("track-summary");
  const counter = document.getElementById("counter");
  const totalCount = filtered.length;

  const completedWithScore = filtered.filter(g =>
    g.status === "Completed" &&
    typeof g.score !== 'undefined' &&
    g.score !== "" &&
    !isNaN(parseFloat(g.score))
  );

  const avgScore = completedWithScore.length
    ? (completedWithScore.reduce((acc, g) => acc + parseFloat(g.score), 0) / completedWithScore.length).toFixed(2)
    : "-";

  counter.innerHTML = `${totalCount}`
  average.innerHTML = `${avgScore}`

  if (filtered.length === 0) {
    grid.innerHTML = '<div style="padding:1rem; color:#999;">//</div>';
    return;
  }

  filtered.forEach(g => {
    const card = document.createElement('div');
    card.className = 'trackcard';
    card.innerHTML = `
      <div class="image-wrapper">
        <img class="trackcard-image${g.fav === "TRUE" ? ' favorite' : ''}" src="${g.banner}" alt="${g.title}">
        <div class="image-overlay">${g.title}${g.score && g.status === "Completed" ? `<br><br>★ ${g.score}` : ""}</div>
      </div>
      <div class="card-content">
        ${g.last}, ${g.year}
      </div>`;
    grid.appendChild(card);
  });

  updateButtonStates();
}


statusButtons.forEach(button => {
  button.addEventListener('click', () => {
    statusButtons.forEach(b => b.classList.remove('active'));
    button.classList.add('active');
    currentStatus = button.dataset.status;
    renderCards();
  });
});

yearButtons.forEach(button => {
  button.addEventListener('click', () => {
    yearButtons.forEach(b => b.classList.remove('active'));
    button.classList.add('active');
    currentYear = button.dataset.year;
    renderCards();
  });
});

typeButtons.forEach(button => {
  button.addEventListener('click', () => {
    typeButtons.forEach(b => b.classList.remove('active'));
    button.classList.add('active');
    currentType = button.dataset.type;
    renderCards();
  });
});

favButtons.forEach(button => {
  button.addEventListener("click", () => {
    favButtons.forEach(btn => btn.classList.remove("active"));
    button.classList.add("active");
    currentFav = button.dataset.fav;
    renderCards();
  });
});

renderCards();
</script>


  </main>
  <script src= "/js/summary.js"></script>
</body>
</html>